# Проект - Pooh JMS
[![Build Status](https://travis-ci.org/DmitriyYugai/job4j_pooh.svg?branch=master)](https://travis-ci.org/DmitriyYugai/job4j_pooh)
# Содержание
* [Использованные технологии](#Использованные-технологии)
* [О проекте](#О-проекте)
* [Сборка](#Сборка)
* [Использование](#Использование)
* [Контакты](#Контакты)
## Использованные технологии
* Java Concurrency (классы из пакета java.util.concurrent)
* Collections Framework
* Библиотека GSON
* Sockets
* Java IO
* Checkstyle plugin
* JaCoCo
* Travis CI
## О проекте
В данном проекте написан код сервера и двух клиентов на сокетах.<br><br> 
Сервер представляет собой систему обмена сообщениями 
и построен на базе потокобезопасных классов из пакета *java.util.concurrent*.<br><br>
Клиенты могут как отправлять так и принимать сообщения. Сообщения передаются в формате JSON 
(для работы с данным форматом используется *библиотека GSON*). На каждого клиента создаётся своя нить.<br><br> 
Интерфейс системы консольный.<br><br>
Система может работать в двух режимах:
* __*Режим Queue*__ - все клиенты записывают (отправляют сообщения) и читают (получают сообщения) из одной и той же очереди.
Примеры запросов на отправку и получение сообщения:<br><br>
*POST /queue {"queue":weather,"text":temp}*<br>
*GET /queue/weather*<br><br>
где weather - название очереди (можно использовать произвольные названия); text - текст сообщения.<br><br>
* __*Режим Topic*__ - у каждого клиента своя собственная очередь. Другими словами, каждый клиент читает из своей собственной очереди, 
но также может записывать (отправлять сообщения) в очереди всех остальных клиентов.
Примеры запросов на отправку и получение сообщения:<br><br>
*POST /topic {"topic":weather,"text":temp}*<br>
*GET /topic/weather*<br><br>
где weather - название очереди (можно использовать произвольные названия); text - текст сообщения.<br><br>
Для завершения работы клиента нужно ввести команду *Exit*.<br><br>
Общая диаграмма зависимостей компонентов сервера:<br><br>
![Diagram](img/about/dep1.PNG)<br><br>
1. Класс __*Start*__ - главный класс системы. Инициализирует необходимые потокобезопасные коллекции 
из *пакета java.util.concurrent* (*ConcurrentHashMap*, *BlockingQueue*), 
запускает сервер на порту 9000 на *ServerSocket*, для каждого клиента создаёт отдельную нить с помощью объекта *ExecutorService*.
2. Класс __*ClientTask*__ - реализует интерфейс Runnable, инкапсулирует в себе сокет клиента и соответствует задаче, выполняемой нитью клиента.
Валидирует поступающие от клиентов запросы и запускает необходимый режим работы системы.
3. Интерфейс __*Mode*__ - за счёт данного интерфейса возможно расширение системы (добавление новых режимов работы). 
Реализуется классами *QueueGet*, *QueuePost*, *TopicGet*, *TopicPost*, которые соответствуют различным режимам работы системы.
4. Классы __*MessageQueuePojo*__, __*MessageTopicPojo*__ - модели данных, соответствующие сообщениям.
5. Классы __*QueueGet*__, __*QueuePost*__, __*TopicGet*__, __*TopicPost*__ - соответствуют различным режимам работы системы.
Используют *библиотеку GSON* для работы с сообщениями.<br><br>
Общая диаграмма зависимостей компонентов клиента:<br><br>
![Diagram](img/about/dep2.PNG)<br><br>
В коде клиента используется класс *java.util.Scanner* для обработки ввода от пользователя, 
а также класс *java.net.Socket* для взаимодействия с сервером.
## Сборка
1. Установить JDK 14.
2. Скачать Maven.
3. Создать переменные окружения JAVA_HOME и M2_HOME и прописать в переменную окружения Path 
пути до бинарных файлов для JDK и для Maven:<br><br>
![Java Maven installing](img/build/java_maven.PNG)<br><br>
4. Скачать исходный код проекта с GitHub.
5. Перейти в корень проекта, где лежит файл pom.xml:<br><br>
![Переход в корень проекта](img/build/cd.PNG)<br>
![Переход в корень проекта](img/build/cd1.PNG)<br><br>
6. С помощью Maven осуществить сборку проекта:<br><br>
![Сборка проекта](img/build/package.PNG)<br><br>
При успешной сборке должна появиться папка target, в которой располагается jar-архив pooh.jar:<br><br>
![Сборка прошла успешно](img/build/package1.PNG)<br>
![Папка target](img/build/target.PNG)<br>
![Файл pooh.jar](img/build/target1.PNG)<br><br>
Сборка завершена. Теперь можно проверить работу системы.
## Использование
Запустим сервер:<br><br>
![Запуск сервера](img/usage/server_start.PNG)<br><br>
Код клиентов располагается в папке target по пути classes/ru/job4j/pooh/clients.
Для запуска клиентов необходимо указать classpath, а также полное имя классов клиентов.<br><br>.
Открываем новую консоль. Запускаем первого клиента (ClientGet):<br><br>
![Запуск первого клиента](img/usage/client1_start.PNG)<br><br>
Открываем новую консоль. Запускаем второго клиента (ClientPost):<br><br>
![Запуск второго клиента](img/usage/client2_start.PNG)<br><br>
Теперь можно проверить режимы работы системы. 
Текст проверочных запросов можно найти в файле testing.txt, который расположен в корне проекта.<br><br>
1. __*Режим Queue.*__<br><br>

Проверим валидацию. Введём некорректные данные:<br><br>
![Проверка валидации](img/usage/validate.PNG)<br><br>
Как видно, валидация работает исправно.<br><br>
Запостим 2 сообщения первым клиентом и одно сообщение вторым клиентом в очередь с названием weather:<br><br>
![Queue Post 1](img/usage/post1.PNG)<br><br>
![Queue Post 2](img/usage/post2.PNG)<br><br>
Теперь считаем 1 сообщение первым клиентом и 2 сообщения вторым клиентом из очереди weather:<br><br>
![Queue Get 1](img/usage/get1.PNG)<br><br>
![Queue Get 2](img/usage/get2.PNG)<br><br>
Так как теперь очередь weather пуста, то считать сообщения из данной очереди не удастся:<br><br>
![Queue Get Fail 1](img/usage/get_fail1.PNG)<br><br>
![Queue Get Fail 2](img/usage/get_fail2.PNG)<br><br>
Как видно, режим Queue работает корректно.<br><br>
2. __*Режим Topic.*__<br><br>

Запостим 2 сообщения первым клиентом и одно сообщение вторым клиентом в очередь с названием weather:<br><br>
![Topic Post 1](img/usage/post3.PNG)<br><br>
![Topic Post 2](img/usage/post4.PNG)<br><br>
Считаем все сообщения, имеющиеся в очереди weather первого клиента:<br><br>
![Topic Get 1](img/usage/get3.PNG)<br><br>
Сделаем то же самое для второго клиента:<br><br>
![Topic Get 2](img/usage/get4.PNG)<br><br>
Как видно, режим Topic работает корректно.<br><br>
Для выхода вводим у обоих клиентов команду Exit:<br><br>
![Exit](img/usage/exit.PNG)
## Контакты
Почта: dmitry_yugay@mail.ru<br>
Skype: live:.cid.9cdc925fb48220b4
